<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Total Differential Value optimization using a Simulated Annealing (and GRASP) algorithm(s) — optim_tdv_simul_anne • The 'diffval' package for R</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Total Differential Value optimization using a Simulated Annealing (and GRASP) algorithm(s) — optim_tdv_simul_anne"><meta name="description" content="This function searches for k-partitions of the columns of a given matrix
(i.e., partitions of the columns into k groups), optimizing the Total
Differential Value (TDV) using a stochastic global optimization method
known as the Simulated Annealing (SANN) algorithm. Optionally, a Greedy
Randomized Adaptive Search Procedure (GRASP) can be used to find an initial
partition (seed) to be passed to the SANN algorithm."><meta property="og:description" content="This function searches for k-partitions of the columns of a given matrix
(i.e., partitions of the columns into k groups), optimizing the Total
Differential Value (TDV) using a stochastic global optimization method
known as the Simulated Annealing (SANN) algorithm. Optionally, a Greedy
Randomized Adaptive Search Procedure (GRASP) can be used to find an initial
partition (seed) to be passed to the SANN algorithm."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">The 'diffval' package for R</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://gitlab.com" aria-label="GitLab"><span class="fa fa-gitlab"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.r-project.org" aria-label="R-Project"><span class="fa fab fa-r-project"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://point-veg.utad.pt/pkgs_en.html" aria-label="POINT-VEG packages"><span class="fa fa-home"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Total Differential Value optimization using a Simulated Annealing (and GRASP) algorithm(s)</h1>
      <small class="dont-index">Source: <a href="https://gitlab.com/point-veg/diffval/-/blob/master/R/optim_tdv_simul_anne.R" class="external-link"><code>R/optim_tdv_simul_anne.R</code></a></small>
      <div class="d-none name"><code>optim_tdv_simul_anne.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function searches for <code>k</code>-partitions of the columns of a given matrix
(i.e., partitions of the columns into <code>k</code> groups), optimizing the Total
Differential Value (TDV) using a stochastic global optimization method
known as the Simulated Annealing (SANN) algorithm. Optionally, a Greedy
Randomized Adaptive Search Procedure (GRASP) can be used to find an initial
partition (seed) to be passed to the SANN algorithm.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optim_tdv_simul_anne</span><span class="op">(</span></span>
<span>  <span class="va">m_bin</span>,</span>
<span>  <span class="va">k</span>,</span>
<span>  p_initial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_runs <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  n_sol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  t_inic <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  t_final <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  use_grasp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thr <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  full_output <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-m-bin">m_bin<a class="anchor" aria-label="anchor" href="#arg-m-bin"></a></dt>
<dd><p>A matrix. A phytosociological table of 0s (absences) and
1s (presences), where rows correspond to taxa and columns correspond to
relevés.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>A numeric giving the number of desired groups.</p></dd>


<dt id="arg-p-initial">p_initial<a class="anchor" aria-label="anchor" href="#arg-p-initial"></a></dt>
<dd><p>A vector of integer numbers with the partition of the
relevés (i.e., a <code>k</code>-partition, consisting in a vector with values from 1
to <code>k</code>, with length equal to the number of columns of <code>m_bin</code>, ascribing
each relevé to one of the <code>k</code> groups), to be used as initial partition in
the Simulated Annealing. For a random partition use <code>p_initial = "random"</code>.
This argument is ignored if <code>use_grasp = TRUE</code>.</p></dd>


<dt id="arg-n-runs">n_runs<a class="anchor" aria-label="anchor" href="#arg-n-runs"></a></dt>
<dd><p>A numeric giving the number of runs. Defaults to 10.</p></dd>


<dt id="arg-n-sol">n_sol<a class="anchor" aria-label="anchor" href="#arg-n-sol"></a></dt>
<dd><p>A numeric giving the number of best solutions to keep in the
final output (only used if <code>full_output</code> is <code>FALSE</code>; if <code>full_output</code> is
<code>TRUE</code> all runs will produce an output). Defaults to 1.</p></dd>


<dt id="arg-t-inic">t_inic<a class="anchor" aria-label="anchor" href="#arg-t-inic"></a></dt>
<dd><p>A numeric giving the initial temperature. Must be greater
than 0 and the maximum admitted value is 1. Defaults to 0.3.</p></dd>


<dt id="arg-t-final">t_final<a class="anchor" aria-label="anchor" href="#arg-t-final"></a></dt>
<dd><p>A numeric giving the final temperature. Must be bounded
between 0 and 1. Usually very low values are needed to ensure convergence.
Defaults to 0.000001.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>A numeric giving the fraction of temperature drop to be used
in the temperature reduction scheme (see Details). Must be bounded between
0 and 1. Defaults to 0.05.</p></dd>


<dt id="arg-n-iter">n_iter<a class="anchor" aria-label="anchor" href="#arg-n-iter"></a></dt>
<dd><p>A numeric giving the number of iterations. Defaults to 1000.</p></dd>


<dt id="arg-use-grasp">use_grasp<a class="anchor" aria-label="anchor" href="#arg-use-grasp"></a></dt>
<dd><p>A logical. Defaults to <code>TRUE</code>. IF <code>TRUE</code>, a GRASP is used
to obtain the initial partitions for the Simulated Annealing. If <code>FALSE</code>
the user should provide an initial partition or use or use
<code>p_initial = "random"</code> for a random one.</p></dd>


<dt id="arg-thr">thr<a class="anchor" aria-label="anchor" href="#arg-thr"></a></dt>
<dd><p>A numeric giving a threshold value (from 0 to 1 ) with the
probability used to compute the sample quantile, in order to get the best
<code>m_bin</code> columns from which to select one to be include in the GRASP
solution (in each step of the procedure). Only needed if <code>use_grasp</code> is
<code>TRUE</code>.</p></dd>


<dt id="arg-full-output">full_output<a class="anchor" aria-label="anchor" href="#arg-full-output"></a></dt>
<dd><p>A logical. Defaults to <code>FALSE</code>. If <code>TRUE</code> extra
information is presented in the output. See Value.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>full_output = FALSE</code> (the default), a list with the following
components (the GRASP component is only returned if <code>use_grasp = TRUE</code>):</p>
<dl><dt>GRASP</dt>
<dd><p>A list with at most <code>n_sol</code> components, each one
containing also a list with two components:</p><dl><dt>par</dt>
<dd><p>A vector with the partition of highest TDV obtained by
GRASP;</p></dd>

<dt>tdv</dt>
<dd><p>A numeric with the TDV of <code>par</code>.</p></dd>


</dl></dd>

<dt>SANN</dt>
<dd><p>A list with at most <code>n_sol</code> components, each one containing
also a list with two components:</p><dl><dt>par</dt>
<dd><p>A vector with the partition of highest TDV obtained by the
(GRASP +) SANN algorithm(s);</p></dd>

<dt>tdv</dt>
<dd><p>A numeric with the TDV of <code>par</code>.</p></dd>


</dl></dd>


</dl><p>If <code>full_output = TRUE</code>, a list with the following components (the GRASP
component is only returned if <code>use_grasp = TRUE</code>):</p>
<dl><dt>GRASP</dt>
<dd><p>A list with <code>n_runs</code> components, each one containing also a
list with two components:</p><dl><dt>par</dt>
<dd><p>A vector with the partition of highest TDV obtained by
GRASP.</p></dd>

<dt>tdv</dt>
<dd><p>A numeric with the TDV of <code>par</code>.</p></dd>


</dl></dd>

<dt>SANN</dt>
<dd><p>A list with <code>n_runs</code> components, each one containing also a
list with six components:</p><dl><dt>current.tdv</dt>
<dd><p>A vector of length <code>n_iter</code> with the current TDV of
each SANN iteration.</p></dd>

<dt>alternative.tdv</dt>
<dd><p>A vector of length <code>n_iter</code> with the alternative
TDV used in each SANN iteration.</p></dd>

<dt>probability</dt>
<dd><p>A vector of length <code>n_iter</code> with the probability
used in each SANN iteration.</p></dd>

<dt>temperature</dt>
<dd><p>A vector of length <code>n_iter</code> with the temperature of
each SANN iteration.</p></dd>

<dt>par</dt>
<dd><p>A vector with the partition of highest TDV obtained by the
(GRASP +) SANN algorithm(s).</p></dd>

<dt>tdv</dt>
<dd><p>A numeric with the TDV of <code>par</code>.</p></dd>


</dl></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Given a phytosociological table (<code>m_bin</code>, with rows corresponding to
taxa and columns corresponding to relevés) this function searches for a
<code>k</code>-partition (<code>k</code>, defined by the user) optimizing the TDV, i.e.,
searches, using a SANN algorithm (optionally working upon GRASP solutions),
for a global maximum of TDV (by rearranging the relevés into <code>k</code> groups).</p>
<p>In the terminology of cluster analysis, taxa correspond to features,
variables, or attributes, while relevés correspond to objects or samples.</p>
<p>This function uses two main algorithms:</p><ol><li><p>An optional GRASP, which is used to obtain initial solutions
(partitions of <code>m_bin</code>) using function <code><a href="partition_tdv_grasp.html">partition_tdv_grasp()</a></code>.
Such initial solutions are then submitted to the SANN algorithm.</p></li>
<li><p>The (main) SANN algorithm, which is used to search for a global
maximum of TDV. The initial partition for each run of SANN can be a
partition obtained from GRASP (if <code>use_grasp = TRUE</code>) or, (if
<code>use_grasp = FALSE</code>), a partition given by the user (using <code>p_initial</code>) or
a random partition (using <code>p_initial = "random"</code>).</p></li>
</ol><p>The SANN algorithm decreases the temperature multiplying the current
temperature by <code>1 - alpha</code> according to a predefined schedule, which is
automatically calculated from the given values for <code>t_inic</code>, <code>t_final</code>,
<code>alpha</code> and <code>n_iter</code>.
Specifically, the cooling schedule is obtained calculating the number of
times that the temperature has to be decreased in order to approximate
<code>t_final</code> starting from <code>t_inic</code>. The number of times that the temperature
decreases, say <code>nt</code>, is calculated by the expression:</p>
<p><code>floor(log(t_final / t_inic) / log(1 - alpha))</code>.</p>
<p>Finally, these decreasing stages are scattered through the desired
iterations (<code>n_iter</code>) homogeneously, by calculating the indices of the
iterations that will experience a decrease in temperature using
<code>floor(n_iter / nt * (1:nt))</code>.</p>
<p>SANN is often seen as an exploratory technique where the temperature
settings are challenging and dependent on the problem. This function tries
to restrict temperature values taking into account that TDV is always
between 0 and 1. Even though, obtaining values of temperature that allow
convergence can be challenging. <code>full_output = TRUE</code> allows the user to
inspect the behaviour of <code>current.tdv</code> and check if convergence fails.
Generally, convergence failure can be spotted when final SANN TDV values
are similar to the initial <code>current.tdv</code>, specially when coming from random
partitions. In such cases, as a rule of thumb, it is advisable to decrease
<code>t_final</code> by a factor of 10.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jorge Orestes Cerdeira and Tiago Monteiro-Henriques.
E-mail: <a href="mailto:tmh.dev@icloud.com">tmh.dev@icloud.com</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Getting the Taxus baccata forests data set</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">taxus_bin</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Removing taxa occurring in only one relevé in order to</span></span></span>
<span class="r-in"><span><span class="co"># reproduce the example in the original article of the data set</span></span></span>
<span class="r-in"><span><span class="va">taxus_bin_wmt</span> <span class="op">&lt;-</span> <span class="va">taxus_bin</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">taxus_bin</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtaining a partition that maximizes TDV using the Simulated Annealing</span></span></span>
<span class="r-in"><span><span class="co"># algorithm</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">optim_tdv_simul_anne</span><span class="op">(</span></span></span>
<span class="r-in"><span>  m_bin <span class="op">=</span> <span class="va">taxus_bin_wmt</span>,</span></span>
<span class="r-in"><span>  k <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  p_initial <span class="op">=</span> <span class="st">"random"</span>,</span></span>
<span class="r-in"><span>  n_runs <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  n_sol <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  use_grasp <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  full_output <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect the result</span></span></span>
<span class="r-in"><span><span class="co"># The TDV of each run</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">[[</span><span class="st">"SANN"</span><span class="op">]</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">tdv</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2005789 0.2005789 0.1958471 0.1958471 0.1699918</span>
<span class="r-in"><span><span class="co"># The best partition that was found (i.e., with highest TDV)</span></span></span>
<span class="r-in"><span><span class="va">result</span><span class="op">[[</span><span class="st">"SANN"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">par</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 3 3 3 3 2 2 3 3 3 3 3 3 3 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A TDV of 0.1958471 indicates you are probably reproducing the three</span></span></span>
<span class="r-in"><span><span class="co"># groups (Estrela, Gerês and Galicia) from the original article. A solution</span></span></span>
<span class="r-in"><span><span class="co"># with TDV = 0.2005789 might also occur, but note that one group has only two</span></span></span>
<span class="r-in"><span><span class="co"># elements. For now, a minimum group size is not implemented in function</span></span></span>
<span class="r-in"><span><span class="co"># optim_tdv_simul_anne() as it is in the function optim_tdv_hill_climb().</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Inspect how the optimization progressed (should increase towards the right)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">result</span><span class="op">[[</span><span class="st">"SANN"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">current.tdv</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"l"</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">"Iteration number"</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="st">"TDV of the currently accepted solution"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">run</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">result</span><span class="op">[[</span><span class="st">"SANN"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">result</span><span class="op">[[</span><span class="st">"SANN"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">run</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">current.tdv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="optim_tdv_simul_anne-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the sorted (or tabulated) phytosociological table, using the best</span></span></span>
<span class="r-in"><span><span class="co"># partition that was found</span></span></span>
<span class="r-in"><span><span class="va">tabul</span> <span class="op">&lt;-</span> <span class="fu"><a href="tabulation.html">tabulation</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  m_bin <span class="op">=</span> <span class="va">taxus_bin_wmt</span>,</span></span>
<span class="r-in"><span>  p <span class="op">=</span> <span class="va">result</span><span class="op">[[</span><span class="st">"SANN"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">par</span>,</span></span>
<span class="r-in"><span>  taxa_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">taxus_bin_wmt</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  plot_im <span class="op">=</span> <span class="st">"normal"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="optim_tdv_simul_anne-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tiago Monteiro-Henriques, Jorge Orestes Cerdeira, Fundação para a Ciência e a Tecnologia, Portugal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

